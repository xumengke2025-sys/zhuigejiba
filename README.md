# 🗺️ 追迹 (Trace) - 你的小说“地图导航”

读玄幻/仙侠小说时，是不是经常被复杂的地图绕晕？
*“主角从青云门出发，向东三百里到了流波山，又下海去了空桑山……”* 
脑子里的地图是不是已经乱成一团麻了？

**“追迹”** 就是为了解决这个问题诞生的！你只需要把小说文件投喂给它，它就会自动帮你把文字变成一张**可交互的复古地图**。

---

### ✨ 它能做什么？

1.  **自动绘制地图** 🎨
    *   上传 TXT 小说，AI 会自动分析里面出现的所有地点（国家、城市、门派、山川）。
    *   它甚至能分清“层级”：比如“皇宫”是在“京城”里面的，而“养心殿”又是在“皇宫”里面的。
    *   生成的地图是**羊皮纸风格**的，代入感满满！

2.  **室内/室外无缝切换** 🔍
    *   在大地图上看到“皇宫”？点它！
    *   地图会瞬间“下钻”，展示皇宫内部的详细布局（大殿、偏殿、御花园、走廊……）。
    *   不再只是一个干巴巴的点，而是一个立体的世界。

3.  **追踪人物足迹** 👣
    *   想知道主角这一路都去过哪？
    *   在左侧选这一张角色，地图上就会高亮显示他的**行动路线**。
    *   走到哪，哪里发生了什么事，一目了然。

4.  **沉浸式剧情回顾** 📜
    *   点击地图上的地点或事件点，右侧会展开一个**卷轴**。
    *   里面记录了这里发生的具体剧情摘要，配合古风界面，像在读原著一样。

---

### 🚀 怎么用？（小白保姆级教程）

为了保证项目轻量，我们上传时去掉了庞大的运行库。**第一次使用**需要按照以下步骤操作：

#### 1. 环境准备
如果你的电脑还没装过运行环境，请先下载并安装：
*   **Python (3.10+)**: [官网下载地址](https://www.python.org/downloads/)（安装时请务必勾选 **"Add Python to PATH"**）
*   **Node.js**: [官网下载地址](https://nodejs.org/)（下载 LTS 长期支持版即可）

#### 2. 配置 AI 钥匙 (API Key)
本项目需要 AI 才能理解小说内容：
1.  找到 `.env.example` 文件，改名为 `.env`。
2.  用记事本打开，填入你的 API Key：
```ini
LLM_API_KEY=你的sk-密钥
LLM_BASE_URL=https://api.deepseek.com # 或者你使用的中转地址
LLM_MODEL_NAME=deepseek-chat
```

#### 3. 一键启动（Windows 用户推荐）
双击项目根目录下的 **`start_all.bat`** 脚本。

它会自动执行：
1.  安装 Python 依赖（如果缺失）
2.  安装 Node.js 依赖（如果缺失）
3.  同时启动后端（5002端口）和前端（3002端口）

*注意：启动过程中会弹出两个黑框窗口，请不要关闭它们。*
*看到 `Service running at: http://127.0.0.1:5002` 和 `Local: http://localhost:3002/` 字样即表示启动成功。*

最后，在浏览器打开 `http://localhost:3002/` 即可使用！

---

### 🔧 手动启动（Mac/Linux 用户或高级用户）

**窗口 1：启动后端**
```bash
cd backend
python -m venv .venv          # 创建虚拟环境（首次）
source .venv/bin/activate     # 激活环境 (Windows: .\.venv\Scripts\activate)
pip install -r requirements.txt # 安装依赖
python run.py                 # 启动服务
```
*成功标志：看到 `Service running at: http://127.0.0.1:5002`*

**窗口 2：启动前端**
```bash
cd frontend
npm install                   # 安装依赖（首次）
npm run dev                   # 启动界面
```
*成功标志：看到 `Local: http://localhost:3002/`*

---

### ❓ 常见问题

*   **Q: 分析一本小说要多久？**
    *   A: 取决于小说长度。通常几百万字的小说可能需要几分钟到十几分钟。你可以先去喝杯茶。
*   **Q: 支持什么格式？**
    *   A: 目前仅支持 **TXT** 纯文本格式。
*   **Q: 为什么有些地点没连起来？**
    *   A: AI 是根据原文描述推断位置的。如果作者没写“从A到了B”，AI 也不敢乱连线哦。

---

### 🛠️ 技术栈（给程序员看的）
*   **Backend**: Python, Flask, OpenAI SDK (LLM)
*   **Frontend**: Vue 3, D3.js (Map Rendering), Vite
*   **Design**: 羊皮纸复古 UI (CSS3 + SVG Filters)
